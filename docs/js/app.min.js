const textbox=document.getElementById("TextBox1"),toolbar1=document.getElementById("TextBox2"),toolbar2=document.getElementById("TextBox3"),toList=text=>text.split(/\n/),replaceText=(requestTextbox,value,replacementValue)=>requestTextbox.value.replace(value,replacementValue),distinct=list=>Array.from(new Set(list)),fromList=listToJoin=>0==listToJoin.length&&""==listToJoin[0]?"":listToJoin.join("\n"),sort=arrayItems=>arrayItems.sort(),ListDisect=transformFunction=>fromList(toList(textbox.value).map(item=>transformFunction(item))),removePrefixXml=xml=>xml.replace(/<[A-Z]+:/g,"<").replace(/<\/[A-Z]+:/g,"</").replace(/[A-Z]+:nil/g,"nil").replace(/[A-Z]+:type/g,"type"),removeXmlns=xml=>xml.replace(/xmlns[^"]*"[^"]*"/g,"").replace(/\s+>/g,">"),debounce=(func,delay)=>{let timeoutId;return()=>{clearTimeout(timeoutId),timeoutId=setTimeout(()=>func(textbox),delay)}},debouncedKeyUp=debounce(keyUp,300),openDialog=(textbox.addEventListener("input",debouncedKeyUp),()=>document.getElementById("OpenFile").click()),singleLine=()=>{textbox.value=replaceText(textbox,/\n/g,""),keyUp(textbox)},distinctList=()=>{try{textbox.value=distinct(toList(textbox.value)).join("\n"),keyUp(textbox)}catch(err){alert(err.message)}},sortList=()=>{try{textbox.value=fromList(sort(toList(textbox.value))),keyUp(textbox)}catch(err){alert(err.message)}},toUpper=()=>textbox.value=textbox.value.toUpperCase(),toLower=()=>textbox.value=textbox.value.toLowerCase(),dupicateLines=()=>{textbox.value=ListDisect(item=>item.toString()+item.toString()),keyUp(textbox)},trimText=method=>{textbox.value=ListDisect(item=>item[method]()),keyUp(textbox)},urlEncode=()=>textbox.value=encodeURI(textbox.value),urlDecode=()=>textbox.value=decodeURI(textbox.value),base64Decode=()=>textbox.value=atob(textbox.value),base64Encode=()=>textbox.value=btoa(textbox.value),removeXMLNamespace=()=>{try{textbox.value=removeXmlns(removePrefixXml(textbox.value))}catch(err){alert(err)}},beautify=type=>{try{textbox.value=vkbeautify[type](textbox.value),keyUp(textbox)}catch(err){alert(err.message)}},getDistintItemsFromLists=()=>{var lists=extractLists();const distinct=getUniqueItemsFromArrays(lists);textbox.value=lists.map(list=>fromList(list.filter(obj=>distinct.includes(obj)))).join("\n\n"),keyUp(textbox)},getMatchingItemsFromLists=()=>{var nonEmptyLists=extractLists(),nonEmptyLists=nonEmptyLists.reduce((common,list)=>list.filter(str=>common.includes(str)),nonEmptyLists[0]||[]);textbox.value=fromList(nonEmptyLists),keyUp(textbox)},speak=()=>{var msg=new SpeechSynthesisUtterance;msg.text=textbox.value,window.speechSynthesis.speak(msg)},txtParse=()=>{try{var tb2=toolbar1.value;""!=tb2&&(textbox.value=parseText(textbox.value,tb2)),keyUp(textbox)}catch(err){alert(err.message)}},insertStart=()=>{var toolbarText=toolbar1.value;textbox.value=toolbarText+textbox.value.replace(/\n/g,"\n"+toolbarText),keyUp(textbox)},insertEnd=()=>{var toolbarText=toolbar1.value;textbox.value=textbox.value.replace(/\n/g,toolbarText+"\n")+toolbarText,keyUp(textbox)},txtReplace=()=>{try{textbox.value=textbox.value.replaceAll(toolbar1.value,toolbar2.value),keyUp(textbox)}catch(err){alert(err.message)}},clearScreen=()=>{[textbox.value,toolbar1.value,toolbar2.value]=["","",""],keyUp(textbox),sessionStorage.clear()},copyToClipboard=()=>{navigator.clipboard.writeText(textbox.value).then(()=>{alert("text copied to clipboard.")}).catch(err=>{alert(err.message)})},downloadFile=extension=>{try{var content=textbox.value,downloadLink=document.createElement("a"),filename="output_"+dateString()+"."+extension;downloadLink.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(content)),downloadLink.setAttribute("download",filename),downloadLink.style.display="none",document.body.appendChild(downloadLink),downloadLink.click(),document.body.removeChild(downloadLink)}catch(err){alert(err.message)}},saveToCache=()=>{var ExistingStorage=readCache();ExistingStorage.push({key:dateString(),value:textbox.value}),localStorage.setItem("CachedItems",JSON.stringify(ExistingStorage)),refreshCacheDropdown()},clearCache=()=>{localStorage.removeItem("CachedItems"),refreshCacheDropdown()},readItem=s=>{var X=readCache().filter(item=>item.key==s)[0];textbox.value=X.value},dateString=()=>{var xNow=new Date;return`${xNow.getFullYear().toString()}-${pd(xNow.getMonth()+1)}-${pd(xNow.getDate())}-${pd(xNow.getHours())}-${pd(xNow.getMinutes())}-`+pd(xNow.getSeconds())},pd=num=>num.toString().padStart(2,"0"),extractLists=()=>{return textbox.value.split(/\n{2,}/).map(list=>list.split("\n").filter(item=>""!==item.trim())).filter(list=>0<list.length)};function getLists(){var list1=[],list2=[];let HasHit=!1;for(const line of toList(textbox.value))""==line?HasHit=!0:(HasHit?list1:list2).push(line);return{L1:list1,L2:list2}}function getUniqueItemsFromArrays(arrays){arrays=arrays.flat();const itemCounts={};for(const item of arrays)itemCounts[item]=(itemCounts[item]||0)+1;return Object.keys(itemCounts).filter(item=>1===itemCounts[item])}function keyUp(txt){var txt=txt.value,charCount=txt.replace(/ /g,"").length,txt=(txt.match(/\n/g)||[]).length+1;document.getElementById("CharCount").textContent=charCount,document.getElementById("RowsCount").textContent=txt}function parseText(text,parseItem){return fromList(text.split(new RegExp(`(?=${parseItem})`,"g")))}const readCache=()=>JSON.parse(localStorage.getItem("CachedItems"))||[];function refreshCacheDropdown(){var Doc=document.getElementById("CacheList"),ExistingStorage=readCache(),temp=document.getElementsByTagName("template")[0];for(Doc.textContent="",item=temp.content.querySelector("a"),i=0;i<ExistingStorage.length;i++)(a=document.importNode(item,!0)).textContent=ExistingStorage[i].key,a.setAttribute("onclick","readItem('"+ExistingStorage[i].key+"')"),Doc.appendChild(a)}document.getElementById("OpenFile").addEventListener("change",eventItem=>{var reader,eventItem=eventItem.target.files[0];eventItem&&((reader=new FileReader).onload=function(event){textbox.value=event.target.result},reader.readAsText(eventItem))}),textbox.addEventListener("dragover",eventItem=>{eventItem.stopPropagation(),eventItem.preventDefault(),eventItem.dataTransfer.dropEffect="copy"},!1),textbox.addEventListener("drop",eventItem=>{eventItem.stopPropagation(),eventItem.preventDefault();var reader=new FileReader;reader.onload=function(event){textbox.value=event.target.result},reader.readAsText(eventItem.dataTransfer.files[0])},!1),window.onbeforeunload=()=>{sessionStorage.setItem("textapp.textarea",textbox.value),sessionStorage.setItem("textapp.toolbar1",toolbar1.value),sessionStorage.setItem("textapp.toolbar2",toolbar2.value)},window.onload=event=>{textbox.value=sessionStorage.getItem("textapp.textarea"),toolbar1.value=sessionStorage.getItem("textapp.toolbar1"),toolbar2.value=sessionStorage.getItem("textapp.toolbar2"),refreshCacheDropdown()};let tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)});document.getElementById("btnSwitch").addEventListener("click",()=>{var invertedTheme="dark"==document.documentElement.getAttribute("data-bs-theme")?"light":"dark";document.documentElement.setAttribute("data-bs-theme",invertedTheme),localStorage.setItem("theme",invertedTheme)}),document.addEventListener("DOMContentLoaded",function(){var darkThemeMq=window.matchMedia("(prefers-color-scheme: dark)");let currentTheme=localStorage.getItem("theme");(currentTheme=!currentTheme&&darkThemeMq.matches?"dark":currentTheme)&&document.documentElement.setAttribute("data-bs-theme",currentTheme)}),document.addEventListener("DOMContentLoaded",function(){function adjustLayout(){var windowWidth=window.innerWidth,buttonGroup=document.getElementById("button-group");770<=windowWidth?buttonGroup.classList.add("btn-group-vertical"):buttonGroup.classList.remove("btn-group-vertical")}adjustLayout(),window.addEventListener("resize",()=>{adjustLayout()})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./serviceWorker.min.js");