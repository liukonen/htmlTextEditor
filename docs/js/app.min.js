const textbox=document.getElementById("TextBox1"),toolbar1=document.getElementById("TextBox2"),toolbar2=document.getElementById("TextBox3"),cachedItems="items",toList=text=>text.split(/\r?\n/),replaceText=(requestTextbox,value,replacementValue)=>requestTextbox.value.replace(value,replacementValue),distinct=list=>Array.from(new Set(list)),fromList=listToJoin=>0==listToJoin.length&&""==listToJoin[0]?"":listToJoin.join("\n"),sort=arrayItems=>arrayItems.sort(),ListDisect=transformFunction=>fromList(toList(textbox.value).map(item=>transformFunction(item))),removePrefixXml=xml=>xml.replace(/<[A-Z]+:/g,"<").replace(/<\/[A-Z]+:/g,"</").replace(/[A-Z]+:nil/g,"nil").replace(/[A-Z]+:type/g,"type"),removeXmlns=xml=>xml.replace(/xmlns[^"]*"[^"]*"/g,"").replace(/\s+>/g,">"),parseText=(text,parseItem)=>fromList(text.split(new RegExp(`(?=${parseItem})`,"g"))),keyUp=txt=>{var txt=txt.value,charCount=txt.replace(/ /g,"").length,txt=(txt.match(/\n/g)||[]).length+1;document.getElementById("CharCount").textContent=charCount,document.getElementById("RowsCount").textContent=txt},debounce=(func,delay)=>{let timeoutId;return()=>{clearTimeout(timeoutId),timeoutId=setTimeout(()=>func(textbox),delay)}},debouncedKeyUp=debounce(keyUp,300),openDialog=(textbox.addEventListener("input",debouncedKeyUp),()=>document.getElementById("OpenFile").click()),singleLine=()=>{textbox.value=replaceText(textbox,/\n/g,""),keyUp(textbox)},distinctList=()=>{try{textbox.value=distinct(toList(textbox.value)).join("\n"),keyUp(textbox)}catch(err){alert(err.message)}},sortList=()=>{try{textbox.value=fromList(sort(toList(textbox.value))),keyUp(textbox)}catch(err){alert(err.message)}},toUpper=()=>textbox.value=textbox.value.toUpperCase(),toLower=()=>textbox.value=textbox.value.toLowerCase(),dupicateLines=()=>{textbox.value=ListDisect(item=>item.toString()+item.toString()),keyUp(textbox)},trimText=method=>{textbox.value=ListDisect(item=>item[method]()),keyUp(textbox)},urlEncode=()=>textbox.value=encodeURI(textbox.value),urlDecode=()=>textbox.value=decodeURI(textbox.value),base64Decode=()=>textbox.value=atob(textbox.value),base64Encode=()=>textbox.value=btoa(textbox.value),removeXMLNamespace=()=>{try{textbox.value=removeXmlns(removePrefixXml(textbox.value))}catch(err){alert(err)}},beautify=type=>{try{textbox.value=vkbeautify[type](textbox.value),keyUp(textbox)}catch(err){alert(err.message)}},getDistintItemsFromLists=()=>{var lists=extractLists();const distinct=getUniqueItemsFromArrays(lists);textbox.value=lists.map(list=>fromList(list.filter(obj=>distinct.includes(obj)))).join("\n\n"),keyUp(textbox)},getMatchingItemsFromLists=()=>{var nonEmptyLists=extractLists(),nonEmptyLists=nonEmptyLists.reduce((common,list)=>list.filter(str=>common.includes(str)),nonEmptyLists[0]||[]);textbox.value=fromList(nonEmptyLists),keyUp(textbox)},speak=()=>{var msg=new SpeechSynthesisUtterance;msg.text=textbox.value,window.speechSynthesis.speak(msg)},txtParse=()=>{try{var tb2=toolbar1.value;""!=tb2&&(textbox.value=parseText(textbox.value,tb2)),keyUp(textbox)}catch(err){alert(err.message)}},insertStart=()=>{var toolbarText=toolbar1.value;textbox.value=toolbarText+textbox.value.replace(/\n/g,"\n"+toolbarText),keyUp(textbox)},insertEnd=()=>{var toolbarText=toolbar1.value;textbox.value=textbox.value.replace(/\n/g,toolbarText+"\n")+toolbarText,keyUp(textbox)},txtReplace=()=>{try{textbox.value=textbox.value.replaceAll(toolbar1.value,toolbar2.value),keyUp(textbox)}catch(err){alert(err.message)}},clearScreen=()=>{[textbox.value,toolbar1.value,toolbar2.value]=["","",""],keyUp(textbox),sessionStorage.clear()},copyToClipboard=()=>{navigator.clipboard.writeText(textbox.value).then(()=>{alert("text copied to clipboard.")}).catch(err=>{alert(err.message)})},downloadFile=extension=>{try{downloadContent(textbox.value,extension)}catch(err){alert(err.message)}},generateFilename=extension=>`output_${dateString()}.`+extension,downloadContent=(content,extension)=>{var blob=new Blob([textbox.value],{type:"text/plain"}),blob=URL.createObjectURL(blob),downloadLink=document.createElement("a"),extension=generateFilename(extension);downloadLink.href=blob,downloadLink.download=extension,document.body.appendChild(downloadLink),downloadLink.click(),document.body.removeChild(downloadLink),URL.revokeObjectURL(blob)},saveToCache=async()=>{var ExistingStorage=await readCache(),ExistingStorage=(ExistingStorage.push({key:dateString(),value:textbox.value}),await compressData(JSON.stringify(ExistingStorage)));localStorage.setItem(cachedItems,btoa(String.fromCharCode.apply(null,new Uint8Array(ExistingStorage)))),await refreshCacheDropdown()},clearCache=async()=>{localStorage.removeItem(cachedItems),await refreshCacheDropdown()},readItem=async s=>{var X=(await readCache()).filter(item=>item.key==s)[0];textbox.value=X.value},dateString=()=>{var xNow=new Date;return`${xNow.getFullYear().toString()}-${pd(xNow.getMonth()+1)}-${pd(xNow.getDate())}-${pd(xNow.getHours())}-${pd(xNow.getMinutes())}-`+pd(xNow.getSeconds())},pd=num=>num.toString().padStart(2,"0"),extractLists=()=>{return textbox.value.split(/\n{2,}/).map(list=>list.split("\n").filter(item=>""!==item.trim())).filter(list=>0<list.length)},getLists=()=>{var list1=[],list2=[];let HasHit=!1;for(const line of toList(textbox.value))""==line?HasHit=!0:(HasHit?list1:list2).push(line);return{L1:list1,L2:list2}},getUniqueItemsFromArrays=arrays=>{arrays=arrays.flat();const itemCounts={};for(const item of arrays)itemCounts[item]=(itemCounts[item]||0)+1;return Object.keys(itemCounts).filter(item=>1===itemCounts[item])},readCache=async()=>{let compressed=localStorage.getItem(cachedItems);if(compressed)return decompressed=await decompressData(Uint8Array.from(atob(compressed),c=>c.charCodeAt(0))),JSON.parse(decompressed);var decompressed=localStorage.getItem("CachedItems");if(decompressed){const compressed=await compressData(decompressed);return localStorage.setItem(cachedItems,btoa(String.fromCharCode.apply(null,new Uint8Array(compressed)))),localStorage.removeItem("CachedItems"),JSON.parse(decompressed)}return[]},refreshCacheDropdown=async()=>{var Doc=document.getElementById("CacheList"),ExistingStorage=await readCache(),temp=document.getElementsByTagName("template")[0];for(Doc.textContent="",item=temp.content.querySelector("a"),i=0;i<ExistingStorage.length;i++)(a=document.importNode(item,!0)).textContent=ExistingStorage[i].key,a.setAttribute("onclick","readItem('"+ExistingStorage[i].key+"')"),Doc.appendChild(a)};document.getElementById("OpenFile").addEventListener("change",eventItem=>{var reader,eventItem=eventItem.target.files[0];eventItem&&((reader=new FileReader).onload=event=>{textbox.value=event.target.result},reader.readAsText(eventItem))}),textbox.addEventListener("dragover",eventItem=>{eventItem.stopPropagation(),eventItem.preventDefault(),eventItem.dataTransfer.dropEffect="copy"},!1),textbox.addEventListener("drop",eventItem=>{eventItem.stopPropagation(),eventItem.preventDefault();var reader=new FileReader;reader.onload=event=>{textbox.value=event.target.result},reader.readAsText(eventItem.dataTransfer.files[0])},!1),window.onbeforeunload=()=>{sessionStorage.setItem("textapp.textarea",textbox.value),sessionStorage.setItem("textapp.toolbar1",toolbar1.value),sessionStorage.setItem("textapp.toolbar2",toolbar2.value)},window.onload=async event=>{textbox.value=sessionStorage.getItem("textapp.textarea"),toolbar1.value=sessionStorage.getItem("textapp.toolbar1"),toolbar2.value=sessionStorage.getItem("textapp.toolbar2"),await refreshCacheDropdown()};let tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(tooltipTriggerEl=>new bootstrap.Tooltip(tooltipTriggerEl));document.getElementById("btnSwitch").addEventListener("click",()=>{var invertedTheme="dark"==document.documentElement.getAttribute("data-bs-theme")?"light":"dark";document.documentElement.setAttribute("data-bs-theme",invertedTheme),localStorage.setItem("theme",invertedTheme)}),document.addEventListener("DOMContentLoaded",()=>{const adjustLayout=()=>{var windowWidth=window.innerWidth,buttonGroup=document.getElementById("button-group");770<=windowWidth?buttonGroup.classList.add("btn-group-vertical"):buttonGroup.classList.remove("btn-group-vertical")};var darkThemeMq=window.matchMedia("(prefers-color-scheme: dark)");let currentTheme=localStorage.getItem("theme");(currentTheme=!currentTheme&&darkThemeMq.matches?"dark":currentTheme)&&document.documentElement.setAttribute("data-bs-theme",currentTheme),adjustLayout(),window.addEventListener("resize",()=>{adjustLayout()})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./serviceWorker.min.js");const compressData=async data=>{var stream=new CompressionStream("gzip"),writer=stream.writable.getWriter();return writer.write((new TextEncoder).encode(data)),writer.close(),new Response(stream.readable).arrayBuffer()},decompressData=async compressedData=>{var stream=new DecompressionStream("gzip"),writer=stream.writable.getWriter();return writer.write(compressedData),writer.close(),new Response(stream.readable).arrayBuffer().then(buffer=>(new TextDecoder).decode(buffer))};