const textbox=document.getElementById("TextBox1"),toolbar1=document.getElementById("TextBox2"),toolbar2=document.getElementById("TextBox3"),cachedItems="items",toList=e=>e.split(/\r?\n/),replaceText=(e,t,o)=>e.value.replace(t,o),distinct=e=>Array.from(new Set(e)),fromList=e=>0==e.length&&""==e[0]?"":e.join("\n"),sort=e=>e.sort(),ListDisect=e=>fromList(toList(textbox.value).map((t=>e(t)))),removePrefixXml=e=>e.replace(/<[A-Z]+:/g,"<").replace(/<\/[A-Z]+:/g,"</").replace(/[A-Z]+:nil/g,"nil").replace(/[A-Z]+:type/g,"type"),removeXmlns=e=>e.replace(/xmlns[^"]*"[^"]*"/g,"").replace(/\s+>/g,">"),parseText=(e,t)=>fromList(e.split(new RegExp(`(?=${t})`,"g"))),keyUp=e=>{const t=e.value,o=t.replace(/ /g,"").length,a=(t.match(/\n/g)||[]).length+1;document.getElementById("CharCount").textContent=o,document.getElementById("RowsCount").textContent=a},debounce=(e,t)=>{let o;return()=>{clearTimeout(o),o=setTimeout((()=>e(textbox)),t)}},debouncedKeyUp=debounce(keyUp,300);textbox.addEventListener("input",debouncedKeyUp);const openDialog=()=>document.getElementById("OpenFile").click(),singleLine=()=>{textbox.value=replaceText(textbox,/\n/g,""),keyUp(textbox)},distinctList=()=>{try{textbox.value=distinct(toList(textbox.value)).join("\n"),keyUp(textbox)}catch(e){alert(e.message)}},sortList=()=>{try{textbox.value=fromList(sort(toList(textbox.value))),keyUp(textbox)}catch(e){alert(e.message)}},toUpper=()=>textbox.value=textbox.value.toUpperCase(),toLower=()=>textbox.value=textbox.value.toLowerCase(),dupicateLines=()=>{textbox.value=ListDisect((e=>e.toString()+e.toString())),keyUp(textbox)},trimText=e=>{textbox.value=ListDisect((t=>t[e]())),keyUp(textbox)},urlEncode=()=>textbox.value=encodeURI(textbox.value),urlDecode=()=>textbox.value=decodeURI(textbox.value),base64Decode=()=>textbox.value=atob(textbox.value),base64Encode=()=>textbox.value=btoa(textbox.value),removeXMLNamespace=()=>{try{textbox.value=removeXmlns(removePrefixXml(textbox.value))}catch(e){alert(e)}},beautify=e=>{try{textbox.value=vkbeautify[e](textbox.value),keyUp(textbox)}catch(e){alert(e.message)}},getDistintItemsFromLists=()=>{const e=extractLists(),t=getUniqueItemsFromArrays(e);textbox.value=e.map((e=>fromList(e.filter((e=>t.includes(e)))))).join("\n\n"),keyUp(textbox)},getMatchingItemsFromLists=()=>{const e=extractLists(),t=e.reduce(((e,t)=>t.filter((t=>e.includes(t)))),e[0]||[]);textbox.value=fromList(t),keyUp(textbox)},speak=()=>{const e=new SpeechSynthesisUtterance;e.text=textbox.value,window.speechSynthesis.speak(e)},txtParse=()=>{try{let e=toolbar1.value;""!=e&&(textbox.value=parseText(textbox.value,e)),keyUp(textbox)}catch(e){alert(e.message)}},insertStart=()=>{const e=toolbar1.value;textbox.value=e+textbox.value.replace(/\n/g,"\n"+e),keyUp(textbox)},insertEnd=()=>{const e=toolbar1.value;textbox.value=textbox.value.replace(/\n/g,e+"\n")+e,keyUp(textbox)},txtReplace=()=>{try{textbox.value=textbox.value.replaceAll(toolbar1.value,toolbar2.value),keyUp(textbox)}catch(e){alert(e.message)}},clearScreen=()=>{[textbox.value,toolbar1.value,toolbar2.value]=["","",""],keyUp(textbox),sessionStorage.clear()},copyToClipboard=()=>{navigator.clipboard.writeText(textbox.value).then((()=>{alert("text copied to clipboard.")})).catch((e=>{alert(e.message)}))},downloadFile=e=>{try{downloadContent(textbox.value,e)}catch(e){alert(e.message)}},generateFilename=e=>`output_${dateString()}.${e}`,downloadContent=(e,t)=>{const o=new Blob([textbox.value],{type:"text/plain"}),a=URL.createObjectURL(o),r=document.createElement("a"),n=generateFilename(t);r.href=a,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},saveToCache=async()=>{const e=await readCache();e.push({key:dateString(),value:textbox.value});const t=await compressData(JSON.stringify(e));localStorage.setItem("items",btoa(String.fromCharCode.apply(null,new Uint8Array(t)))),await refreshCacheDropdown()},clearCache=async()=>{localStorage.removeItem("items"),await refreshCacheDropdown()},readItem=async e=>{const t=(await readCache()).filter((t=>t.key==e))[0];textbox.value=t.value},dateString=()=>{const e=new Date;return`${e.getFullYear().toString()}-${pd(e.getMonth()+1)}-${pd(e.getDate())}-${pd(e.getHours())}-${pd(e.getMinutes())}-${pd(e.getSeconds())}`},pd=e=>e.toString().padStart(2,"0"),extractLists=()=>textbox.value.split(/\n{2,}/).map((e=>e.split("\n").filter((e=>""!==e.trim())))).filter((e=>e.length>0)),getLists=()=>{const e=toList(textbox.value),t=[],o=[];let a=!1;for(const r of e)""==r?a=!0:a?t.push(r):o.push(r);return{L1:t,L2:o}},getUniqueItemsFromArrays=e=>{const t=e.flat(),o={};for(const e of t)o[e]=(o[e]||0)+1;return Object.keys(o).filter((e=>1===o[e]))},readCache=async()=>{let e=localStorage.getItem("items");if(e){const t=await decompressData(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))));return JSON.parse(t)}const t=localStorage.getItem("CachedItems");if(t){const e=await compressData(t);return localStorage.setItem("items",btoa(String.fromCharCode.apply(null,new Uint8Array(e)))),localStorage.removeItem("CachedItems"),JSON.parse(t)}return[]},refreshCacheDropdown=async()=>{const e=document.getElementById("CacheList"),t=await readCache(),o=document.getElementsByTagName("template")[0];for(e.textContent="",item=o.content.querySelector("a"),i=0;i<t.length;i++)a=document.importNode(item,!0),a.textContent=t[i].key,a.setAttribute("onclick","readItem('"+t[i].key+"')"),e.appendChild(a)};document.getElementById("OpenFile").addEventListener("change",(e=>{let t=e.target.files[0];if(!t)return;let o=new FileReader;o.onload=e=>{textbox.value=e.target.result},o.readAsText(t)})),textbox.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),!1),textbox.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault();let t=new FileReader;t.onload=e=>{textbox.value=e.target.result},t.readAsText(e.dataTransfer.files[0])}),!1),window.onbeforeunload=()=>{sessionStorage.setItem("textapp.textarea",textbox.value),sessionStorage.setItem("textapp.toolbar1",toolbar1.value),sessionStorage.setItem("textapp.toolbar2",toolbar2.value)},window.onload=async e=>{textbox.value=sessionStorage.getItem("textapp.textarea"),toolbar1.value=sessionStorage.getItem("textapp.toolbar1"),toolbar2.value=sessionStorage.getItem("textapp.toolbar2"),await refreshCacheDropdown()};let tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map((e=>new bootstrap.Tooltip(e)));document.getElementById("btnSwitch").addEventListener("click",(()=>{let e="dark"==document.documentElement.getAttribute("data-bs-theme")?"light":"dark";document.documentElement.setAttribute("data-bs-theme",e),localStorage.setItem("theme",e)})),document.addEventListener("DOMContentLoaded",(()=>{const e=()=>{let e=window.innerWidth,t=document.getElementById("button-group");e>=770?t.classList.add("btn-group-vertical"):t.classList.remove("btn-group-vertical")},t=window.matchMedia("(prefers-color-scheme: dark)");let o=localStorage.getItem("theme");!o&&t.matches&&(o="dark"),o&&document.documentElement.setAttribute("data-bs-theme",o),e(),window.addEventListener("resize",(()=>{e()}))})),"serviceWorker"in navigator&&navigator.serviceWorker.register("./serviceWorker.min.js");const compressData=async e=>{const t=new CompressionStream("gzip"),o=t.writable.getWriter();return o.write((new TextEncoder).encode(e)),o.close(),new Response(t.readable).arrayBuffer()},decompressData=async e=>{const t=new DecompressionStream("gzip"),o=t.writable.getWriter();return o.write(e),o.close(),new Response(t.readable).arrayBuffer().then((e=>(new TextDecoder).decode(e)))};